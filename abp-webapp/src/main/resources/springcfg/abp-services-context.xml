<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:aop="http://www.springframework.org/schema/aop"
             xsi:schemaLocation="
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
            http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-2.5.xsd">

    <!--  TODO line below should be replaced with aop:spring-configured -->
    <!--  but thanks to a jwebunit dependency on xerces xml parser having this line -->
    <!--  in place breaks the build as XSD validation of this doc fails -->
    <!--  the line below has the same effect as the XML tag and is a temporary workaround -->
    <!--  until the XML parser runtime issues have been resolved -->
    <bean class="org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect"
                factory-method="aspectOf"/>


    <!-- ####################################### -->
    <!--          JMS Spring Beans               -->
    <!-- ####################################### -->
    <!-- JNDI Environment Template -->
    <bean id="jndiTemplate" class="org.springframework.jndi.JndiTemplate">
        <property name="environment">
            <props>
                <prop key="java.naming.factory.initial">${abp.jms.java.naming.factory.initial}</prop>
                <prop key="java.naming.provider.url">${abp.jms.java.naming.provider.url}</prop>
                <prop key="java.naming.factory.url.pkgs">${abp.jms.java.naming.factory.url.pkgs}</prop>
            </props>
        </property>
    </bean>

    <!-- JMS Queue Connection Factory -->
    <bean id="internalJmsQueueConnectionFactory" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate"><ref bean="jndiTemplate"/></property>
        <property name="jndiName"><value>${abp.jms.jndiName.connectionFactoryName}</value></property>
    </bean>

    <bean id="loginQueue" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate" ref="jndiTemplate"/>
        <property name="jndiName" value="${abp.jms.auth.request.queuename}"/>
    </bean>

    <bean id="atgSessionStartQueue" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate" ref="jndiTemplate"/>
        <property name="jndiName" value="${abp.jms.atgSession.start.queuename}"/>
    </bean>

    <bean id="flightInfoQueue" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate" ref="jndiTemplate"/>
        <property name="jndiName" value="${abp.jms.flightinfo.request.queuename}"/>
    </bean>

    <bean id="flightSystemQueue" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate" ref="jndiTemplate"/>
        <property name="jndiName" value="${abp.jms.flightsystemstatus.request.queuename}"/>
    </bean>

    <bean id="sessionInfoQueue" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate" ref="jndiTemplate"/>
        <property name="jndiName" value="${abp.jms.sessioninfo.request.queuename}"/>
    </bean>

 <bean id="prepareToLandMessageListenerTopic" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiTemplate" ref="jndiTemplate"/>
        <property name="jndiName" value="${abp.jms.flightInformation.topicname}"/>
    </bean>
    <bean id="jmsDestinationResolver"
                class="org.springframework.jms.support.destination.JndiDestinationResolver">
        <property name="jndiTemplate">
            <ref bean="jndiTemplate"/>
        </property>
        <property name="cache">
            <value>false</value>
        </property>
    </bean>

    <!-- JMS Queue Template -->
    <bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate">
        <property name="connectionFactory">
            <ref bean="internalJmsQueueConnectionFactory"/>
        </property>
        <property name="receiveTimeout">
            <value>${abp.jms.jmsTemplate.receiveTimeout}</value>
        </property>
        <property name="destinationResolver">
            <ref bean="jmsDestinationResolver"/>
        </property>
    </bean>

    <!-- ####################################### -->
    <!--          Application Services           -->
    <!-- ####################################### -->

    <bean id="jmsFlightInfoService" class="com.aircell.abp.service.JmsSyncOperator" init-method="checkDependenciesSet">
        <property name="connectionFactory" ref="internalJmsQueueConnectionFactory"/>
        <property name="destination" ref="flightInfoQueue"/>
        <property name="receiveTimeout" value="${abp.jms.jmsTemplate.receiveTimeout}"/>
    </bean>

    <bean id="flightInfoService" class="com.aircell.abp.service.FlightInfoJmsImpl" init-method="checkDependenciesSet">
        <property name="flightInfoJmsPropertyKey" value="Message"/>
        <property name="flightInfoJmsPropertyValue" value="FlightInfoRequest"/>
        <property name="jmsSyncService" ref="jmsFlightInfoService"/>
    </bean>

    <bean id="jmsFlightSystemService" class="com.aircell.abp.service.JmsSyncOperator" init-method="checkDependenciesSet">
        <property name="connectionFactory" ref="internalJmsQueueConnectionFactory"/>
        <property name="destination" ref="flightSystemQueue"/>
        <property name="receiveTimeout" value="${abp.jms.jmsTemplate.receiveTimeout}"/>
    </bean>

    <bean id="flightSystemService" class="com.aircell.abp.service.FlightSystemServiceImpl" init-method="checkDependenciesSet">
        <property name="flightSystemJmsPropertyKey" value="Message"/>
        <property name="flightSystemJmsPropertyValue" value="SystemStatusRequest"/>
        <property name="jmsSyncService" ref="jmsFlightSystemService"/>
    </bean>

    <bean id="jmsLoginService" class="com.aircell.abp.service.JmsSyncOperator" init-method="checkDependenciesSet">
        <property name="connectionFactory" ref="internalJmsQueueConnectionFactory"/>
        <property name="destination" ref="loginQueue"/>
        <property name="receiveTimeout" value="${abp.jms.jmsTemplate.receiveTimeout}"/>
    </bean>

    <bean id="loginService" class="com.aircell.abp.service.JmsLoginService" init-method="checkDependenciesSet">
        <property name="jmsSyncService" ref="jmsLoginService"/>
    </bean>

    <bean id="jmsSessionInfoService" class="com.aircell.abp.service.JmsSyncOperator" init-method="checkDependenciesSet">
        <property name="connectionFactory" ref="internalJmsQueueConnectionFactory"/>
        <property name="destination" ref="sessionInfoQueue"/>
        <property name="receiveTimeout" value="${abp.jms.jmsTemplate.receiveTimeout}"/>
    </bean>

    <bean id="sessionInfoService" class="com.aircell.abp.service.SessionInfoJmsImpl" init-method="checkDependenciesSet">
        <property name="sessionInfoJmsPropertyKey" value="Message"/>
        <property name="sessionInfoJmsPropertyValue" value="SessionInformationRequest"/>
        <property name="jmsSyncService" ref="jmsSessionInfoService"/>
    </bean>

    <bean id="jmsAtgSessionService" class="com.aircell.abp.service.JmsSyncOperator" init-method="checkDependenciesSet">
        <property name="connectionFactory" ref="internalJmsQueueConnectionFactory"/>
        <property name="destination" ref="atgSessionStartQueue"/>
        <property name="receiveTimeout" value="${abp.jms.jmsTemplate.receiveTimeout}"/>
    </bean>

    <bean id="atgSessionService" class="com.aircell.abp.service.JmsATGSessionService" init-method="checkDependenciesSet">
        <property name="jmsSyncService" ref="jmsAtgSessionService"/>
        <property name="jmsTemplate" ref="jmsTemplate"/>
        <property name="endATGSessionQueueName" value="${abp.jms.atgSession.end.queuename}"/>
        <property name="endATGSessionMsgPropertyKey" value="Message"/>
        <property name="endATGSessionMsgPropertyValue" value="TerminateUserSession"/>
    </bean>

	<!-- Flight Landing Alert Listener Service -->
	<bean id="prepareToLandMessageListener" class="com.aircell.abp.service.PrepareToLandAlertListener" init-method="checkDependenciesSet">
		<property name="flight" ref="flight"/>
	</bean>

	 <bean id="prepareToLandMessageListenerContainer" class="org.springframework.jms.listener.DefaultMessageListenerContainer">
		<property name="concurrentConsumers" value="1"/>
		<property name="connectionFactory" ref="internalJmsQueueConnectionFactory"/>
		<property name="destination" ref="prepareToLandMessageListenerTopic"/>
		<property name="messageListener" ref="prepareToLandMessageListener"/>
    </bean>

    <!-- ####################################### -->
    <!--          Domain objects config          -->
    <!-- ####################################### -->

    <bean class="com.aircell.abp.model.CreditCardDetails" lazy-init="true">
    <property name="mastercardKey" value="MASTER" />
    <property name="visaKey" value="VISA" />
    <property name="amexKey" value="AMEX" />
    <property name="discoverKey" value="DISCOV" />
    </bean>

    <bean class="com.aircell.abp.model.AirPassenger" lazy-init="true">
        <property name="loginService" ref="loginService"/>
        <property name="atgSessionService" ref="atgSessionService"/>
        <property name="sessionInfoService" ref="sessionInfoService"/>
    </bean>
	
    <bean id="flight" class="com.aircell.abp.model.Flight">
        <property name="flightSystemService" ref="flightSystemService"/>
        <property name="flightInfoService" ref="flightInfoService"/>
        <property name="videoConfigFilePath" value="${video-config.file.path}" />
        <property name="videoFrameFilePath" value="${video-frame.file.path}" />
        <property name="mediaPath" value="${media.file.path}" />
        <property name="mediaFileType" value="${media.file.type}" />
        <property name="trailerFileType" value="${trailer.file.type}" />
        <property name="boxArtSmallFileType" value="${boxart.small.file.type}" />
        <property name="boxArtMediumFileType" value="${boxart.medium.file.type}" />
        <property name="boxArtLargeFileType" value="${boxart.large.file.type}" />
        <property name="boxArtExtraLargeFileType" value="${boxart.extralarge.file.type}" />
        <property name="videoPluginPath" value="${video-plugin.file.path}" />
    </bean>
    

</beans>